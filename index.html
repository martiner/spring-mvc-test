<!--
Google IO 2012/2013 HTML5 Slide Template

Authors: Eric Bidelman <ebidel@gmail.com>
         Luke Mah√© <lukem@google.com>

URL: https://code.google.com/p/io-2012-slides
-->
<!DOCTYPE html>
<html>
<head>
  <title></title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">-->
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
  <!--This one seems to work all the time, but really small on ipad-->
  <!--<meta name="viewport" content="initial-scale=0.4">-->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <link rel="stylesheet" media="all" href="theme/css/default.css">
  <link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="theme/css/phone.css">
  <base target="_blank"> <!-- This amazingness opens all links in a new tab. -->
  <script data-main="js/slides" src="js/require-1.0.8.min.js"></script>
</head>
<body style="opacity: 0">

<slides class="layout-widescreen">

  <slide class="title-slide nobackground">
    <hgroup class="auto-fadein">
      <h1 data-config-title><!-- populated from slide_config.json --></h1>
      <h2 data-config-subtitle><!-- populated from slide_config.json --></h2>
      <p data-config-presenter><!-- populated from slide_config.json --></p>
    </hgroup>
  </slide>

  <slide>
    <hgroup>
      <h2>Spring MVC Test</h2>
    </hgroup>
    <article>
      <ul>
        <li>unit test Spring MVC controllers</li>
        <li>part of spring-test since Spring 3.2</li>
        <li>fast - test just one controller</li>
      </ul>
    </article>
  </slide>

  <slide>
    <hgroup>
      <h2>Controller</h2>
    </hgroup>
    <article class="smaller">
      <pre class="prettyprint" data-lang="java">
<b>@Controller
@RequestMapping("/my")</b>
public class MyController {

    private final MyService service;

    @Autowired
    public MyController(MyService service) {
        this.service = service;
    }

<b>
    @RequestMapping(method = RequestMethod.GET)
    @ResponseBody</b>
    public List&lt;MyEntity> list() {
        return service.list();
    }
}
</pre></article>
  </slide>

  <slide>
    <hgroup>
      <h2>Setup Test</h2>
    </hgroup>
    <article class="smaller">
      <pre class="prettyprint" data-lang="java">
@RunWith(SpringJUnit4ClassRunner.class)
@WebAppConfiguration
public class MyControllerTest {

    @Autowired WebApplicationContext wac;

    <b>MockMvc mockMvc;</b>

    @Before
    public void setUp() throws Exception {
        <b>this.mockMvc = webAppContextSetup(this.wac).build();</b>
    }
}
</pre></article>
  </slide>

  <slide>
    <hgroup>
      <h2>Perform test and expect</h2>
    </hgroup>
    <article class="smaller">
      <pre class="prettyprint" data-lang="java">
public class MyControllerTest {

    @Autowired WebApplicationContext wac;

    <b>MockMvc mockMvc;</b>

    @Before
    public void setUp() throws Exception {
        <b>this.mockMvc = webAppContextSetup(this.wac).build();</b>
    }

    @Test
    public void testList() throws Exception {
        <b>mockMvc</b>.perform(<b>get</b>("/my"))
                .andDo(<b>print</b>())
                .andExpect(<b>status</b>().isOk())
                .andExpect(<b>handler</b>().methodName(is("list")))
                .andExpect(<b>header</b>().string("Content-Type", is("application/json;charset=UTF-8")))
                .andExpect(<b>content</b>().string(is("[{\"id\":\"1\"},{\"id\":\"2\"}]")))
                .andExpect(<b>jsonPath</b>("$[0].id").value(is("1")));
    }
}
</pre></article>
  </slide>

  <slide>
    <hgroup>
      <h2>Test - doPrint()</h2>
    </hgroup>
    <article class="smaller">
      <pre>
<b>MockHttpServletRequest:</b>
         HTTP Method = GET
         Request URI = /my
          Parameters = {}
             Headers = {}
             Handler:
                Type = MyController
              Method = public java.util.List&lt;MyEntity> MyController.list()
<b>  Resolved Exception:</b>
                Type = null
<b>        ModelAndView:</b>
           View name = null
                View = null
               Model = null
<b>            FlashMap:</b>
<b>MockHttpServletResponse:</b>
              Status = 200
       Error message = null
             Headers = {Content-Type=[application/json;charset=UTF-8]}
        Content type = application/json;charset=UTF-8
                Body = []
       Forwarded URL = null
      Redirected URL = null
             Cookies = []
</pre></article>
  </slide>


  <slide>
    <hgroup>
      <h2>Configure Beans and Mocks</h2>
    </hgroup>
    <article class="smaller">
      <pre class="prettyprint" data-lang="java">
@RunWith(SpringJUnit4ClassRunner.class)
<b>@ContextConfiguration(classes = MyControllerTest.Config.class)</b>
@WebAppConfiguration
public class MyControllerTest {

    <b>@Configuration</b>
    @EnableWebMvc
    static class Config {

        <b>@Bean</b> MyController controller(MyService service) {
            return <b>new MyController(service)</b>;
        }

        <b>@Bean</b> MyService service() {
            return <b>mock(MyService.class)</b>;
        }
    }
}
</pre>
</article>
  </slide>

  <slide>
    <hgroup>
      <h2>Mock Behaviour</h2>
    </hgroup>
    <article class="smaller">
      <pre class="prettyprint" data-lang="java">
public class MyControllerTest {

    @Autowired WebApplicationContext wac;

    <b>@Autowired MyService service;</b>

    MockMvc mockMvc;

    @Before
    public void setUp() throws Exception {
        this.mockMvc = webAppContextSetup(this.wac).build();
        <b>when(service.list()).thenReturn(asList(new MyEntity("1"), new MyEntity("2")));</b>
    }

    @Test
    public void testList() throws Exception {
        mockMvc.perform(get("/my"))
                .andExpect(content().string(is("[{\"id\":\"1\"},{\"id\":\"2\"}]")));
    }
}
</pre>
</article>
  </slide>

  <slide>
    <hgroup>
      <h2>How to</h2>
    </hgroup>
    <article class="smaller">
      <h4>prevent component scan clash</h4>
      <pre class="prettyprint" data-lang="java">
<b>@ActiveProfiles("unit")</b>
public class MyControllerTest {

    @Configuration
    <b>@Profile("unit")</b>
    static class Config {
    }
}
</pre>

      <h4>customize Spring MVC configuration</h4>
      <pre class="prettyprint" data-lang="java">
    @Configuration
    @EnableWebMvc
    static class Config <b>extends WebMvcConfigurerAdapter</b> {

        @Override
        public void <b>addInterceptors</b>(InterceptorRegistry registry) {
            super.addInterceptors(registry);
        }

        @Override
        public void <b>addArgumentResolvers</b>(List<HandlerMethodArgumentResolver> argumentResolvers) {
            super.addArgumentResolvers(argumentResolvers);
        }
    }
</pre>
</article>
  </slide>

  <slide>
    <hgroup>
      <h2>Resources</h2>
    </hgroup>
    <article>
      <ul>
        <li><a href="http://martiner.github.io/spring-mvc-test/">this slides</a></li>
        <li><a href="https://github.com/martiner/spring-mvc-test">example source code</a></li>
        <li><a href="http://docs.spring.io/spring/docs/3.2.x/spring-framework-reference/html/testing.html#spring-mvc-test-framework">Spring MVC Test Framework documentation</a></li>
      </ul>
    </article>
  </slide>

  <slide class="backdrop"></slide>

</slides>

<!--[if IE]>
  <script src="http://ajax.googleapis.com/ajax/libs/chrome-frame/1/CFInstall.min.js"></script>
  <script>CFInstall.check({mode: 'overlay'});</script>
<![endif]-->
</body>
</html>
